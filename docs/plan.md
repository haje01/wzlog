---
layout: page
title: 로그 표준화 계획
---

## 로그 표준화란?
로그 표준화는 회사나 조직에서 로그의 수집, 분석, 활용에 용이하도록 서로 다른 서비스간 로그의 형식을 일관성있게 하고, 향후의 변경 및 추가 작업도 예측 가능한 방식을 따르도록 하여 관련 리소스 최적화와 데이터의 가치를 높이려는 활동을 말한다.

로그 표준화는 단순히 한 차례로 제정으로 끝나는 것이 아니라, 지속적인 의견 수렴, 개선 그리고 활용을 통해 관계자들이 함께 만들어 나가야 한다.

### 로그 표준화 위원회
로그 표준화는 한 두 사람의 힘으로 단기간에 이루어 질 수 없기에, 로그 표준화를 위한 위원회를 제안한다. 위원회는 개발, 분석, 인프라 등 사내의 다양한 분야에서 로그 관련 업무를 맡고 있는 담당자들로 구성되며, 다음과 같은 일을 수행한다.

- 로그 표준안 협의
- 로그 표준 명세 작성
- 로그 표준화 관련 툴의 개발
- 로그 표준 전파 및 서비스 별 담당자와 커뮤니케이션
- 개선안 반영

## 표준의 다양한 필요성
로그 표준화의 목적에 동의하는 것은 어렵지 않으나, 조직 구성원 각자의 역할 및 입장에서 바라본 로그 표준화는 다양한 필요성을 가진다.

### 서비스 개발자
- 어떤 로그를 어떻게 남겨야 하는지에 대한 가이드 문서를 제공하는가?
- 표준을 따르되, 필요에 따라 로그의 추가/변경이 용이한가?
- 내가 생성한 로그가 표준을 만족하는지 테스트할 수 있는가?
- 개발 언어에서 쉽게 쓸 수 있는 로그 객체나 출력기를 제공하는가?

### 시스템 엔지니어
- 배포나 서버 증/감설에 용이한 구조를 가지고 있는가?
- 로그 출력 미디어가 설치 및 운영에 용이한가?

### 데이터 엔지니어
- 로그의 출력 대상이 적절한 미디어(파일, RDB, 하둡 등)로 가능한가?
- 로그 수집/정리에 필요한 문서 및 샘플을 제공하는가?
- 로그 구조 변경시 버전 관리가 용이한가?

### 분석/데이터 과학자
- 로그 분석에 필요한 문서 및 샘플을 제공하는가?
- 분석에 필요한 충분한 정보를 담고 있는가?
- 서비스 별로 비슷한 정보는 일관성 있는 형식으로 저장되어 있는가?
- 로그 구조 변경시 버전 관리가 용이한가?

### 경영자 및 관리부서
- 신규 서비스를 위한 가이드 문서가 존재하는가?
- 인력 이탈이나 교체에 대응하도록 일관된 형식을 갖는가?
- 운영 지표 추출에 충분한 정보를 담고 있는가?
- 해외 서비스를 위한 다국어 문서를 지원하는가?

## 다루지 않는 것
로그 전반의 다양한 필요성에도 불구하고, 효율적인 표준 정립과 전파라는 핵심에 집중하기 위해 일단 다음의 내용은 표준화에서 다루지 않는다.

- 특정 로그 저장 미디어 및 수집 방식
- 개발 언어별 로그 저장 방식
- 기타 엔지니어링 측면의 세부 사항

## 로그 표준의 요건
앞에서 말한 다양한 필요성을 만족하고, 건강한 표준으로서의 로그 작성 및 활용을 위해서 다음과 같은 요건을 제안한다.

### 로그 명세를 URL을 통해 누구나 접근이 가능하도록 공개
- 다양한 관련자의 공유/활용을 위해 공개는 필수적이다.
- 로그의 내용과 달리, 로그의 명세는 보안 및 개인정보에 민감하지 않다.
- URL을 통해 제공하는 것으로, 다양한 명세 파일이 산재하는 혼란을 피할 수 있다.

### 로그 명세는 독점 포맷 및 바이너리 형식이 아닐 것
- 특정 업체의 상용 스프레드 쉬트나 워드 프로세스로 기술된 명세는 접근성 문제가 발생할 수 있다.
- 바이너리 포맷은 버전 관리가 어렵다.

### 스키마를 통해 비슷한 정보는 일관성 있게 표시
- 스키마리스는 사용하기에 편리할 수 있으나, 로그 명세 관리 이슈와 필요없는 중복을 낳을 수 있음.
- 조직내 비슷한 내용의 로그는 비슷한 형식을 갖도록하여, 다양한 로그의 일관적인 처리 및 활용성을 제고하자.

### 로그 명세는 독립적인 형식(Formulation) 언어로 기술할 것
- 자연어로 기술된 표준은 모호성이 상존하기에, 논리적 완결성을 가진 언어를 사용하는 것이 바람직하다.
- SQL이나 특정 프로그래밍 언어에 의존한 기술은, 로그 표준을 위한 다양한 필요성을 만족시킬 수 없다.

### 개발측에도 도움이 되는 표준
- 퍼블리셔의 입장을 강요하는 표준이 아니라, 개발측에 실질적인 도움이 되는 방법론으로서 자리메김 할것.


## 로그 표준화의 방향
앞의 요건을 만족하도록 아래와 같은 표준화 방향을 제안한다.

- 로그 정의용 언어를 만들고, 이를 활용하여 로그 표준안을 기술한다.
- 위원회는 이 언어로 표준 로그 명세를 확정하고, 관련 툴과 함께 제공한다.
- 개발측은 이것을 준수/확장하여 실제 서비스 로그를 개발한다.
- 로그 표준안 및 이를 활용한 서비스별 로그 명세 관리는 Github의 공개 저장소를 사용한다.


## 로그 설계 프레임웍의 개발
앞의 방향에 맞도록 다음과 같은 기능의 로그 설계 프레임웍을 개발한다.

### 객체 지향적 로그 설계
- 기존 로그의 정의서를 보면 이벤트는 다양하나 많은 중복 속성이 있음을 알 수 있다.
- 중복에는 필요없는 비용과 오류가 따르기 마련이다.
- 객체 지향적 로그 설계로 이런 단점을 방지하고, 로그의 유지 보수성을 좋게 한다.

### 로그 문서 생성
- 로그 정의 언어로 기술한 로그 명세에서 다양한 포맷(Text, HTML, Markdown)의 로그 설명 문서를 자동 생성한다.
- 로그 명세에 다국어 설명이 포함되면 해당 언어를 위한 문서도 생성한다.

### 샘플 로그 생성
로그 명세에는 실제 로그와 같지 않더라도, 유용한 샘플 로그 생성에 충분한 정보를 담고 있다. 샘플로그 생성 기능으로,

- 개발자는 로그의 예를 보며 로그 코딩 작업을 할 수 있다.
- 데이터 엔지니어는 서비스 오픈전에 미리 수집/처리 개발을 진행할 수 있다.
- 데이터 과학자는 샘플 기반으로 지표 및 분석의 틀을 미리 준비할 수 있다.

샘플 로그의 출력은 다양한 포맷(JSON, CSV/TSV, SQL)을 지원한다.

### 로그 검증
- 개발 측에서 생성된 로그가 로그 정의에 맞는지 테스트 기능을 제공한다.

### 로그 스키마 생성
- 다양한 로그 출력 미디어 지원을 위해, 로그 정의에서 RDB, Parquet 등을 위한 로그 스키마를 자동 생성한다.


## 표준 로그의 내용
좋은 그릇도 나쁜 음식이 담겨 있으면 의미가 없을 것이다. 앞에서 말한 방식을 사용해 작성될 로그 표준 명세에는 어떤 내용이 담겨야 할까? 구체적인 명세는 앞으로 인터뷰를 통해 로그 정의 언어로 작성될 것이며, 이곳에는 어떤 정보를 어떻게 남겨야 하는지에 대한 원칙을 기록할 예정이다.

### 이벤트와 필드
* **이벤트**는 로그인/아웃처럼 서비스내 특정 사건에 관한 정보를 남긴다.
* **필드**는 이벤트에 속한 구체적인 값을 남긴다.
  * 필드는 구체적인 타입과 값을 가진다.
  * 예를 들어, 일시 타입 필드의 경우 `2019-11-23 09:18:43` 식의 값을 가질 것이다.
* 하나의 이벤트에는 복수의 필드가 존재한다.
  * 이벤트 별로 필요에 따라 다양한 필드를 추가할 수 있으나, 로그의 특성상 공통 필드가 존재한다.
  * 대표적인 공통 필드는 이벤트 발생 일시, 서버 및 유저/세션 정보 등이 있다.
* CSV/TSV 같은 텍스트 형식 로그의 경우, 한 이벤트는 한 줄로 남겨야 한다.
* 같은 종류의 이벤트는 같은 구조를 갖는다.

[[TODO]]

## 작업 산출물
앞에서 말한 방향에 의거하여, 위원회는 다음과 같은 3 가지를 산출물을 제공한다.

1. 로그 정의용 언어
2. 이 언어로 기술된 확장 가능한 로그 표준
3. 로그 개발 및 활용에 도움을 주는 툴

개발측은 이 산출물을 활용해 다음과 같은 2 가지의 산출물을 생산한다.

1. 로그 표준안 기반으로 서비스의 필요에 맞게 수정/확장된 로그 명세
2. 서비스 로그 명세에 맞추어 로그를 생성하는 서비스 코드


## 레가시의 수용

회사에는 조직 내/외부에서 개발한 다양한 서비스의 로그가 생성/활용 되고 있다. 일관된 형태는 아닐지라도, 이 로그들은 다양한 경험과 지식의 산물인 것이다. 표준화 위원회는 다음 두 가지 방법으로 기존 레가시를 포용할 수 있겠다.

### 기존 로그의 노하우를 새 표준에 반영
- 기존 로그를 만들고 활용한 담당자들과 인터뷰를 통해, 왜 그런 로그가 왜 만들어 졌고, 어떻게 사용되고 있는지 파악.
- 그 노하우를 살려 새로운 로그 표준 설계에 반영.

### 임포터를 통해 표준 로그 형태로 변환
- 스프레드쉬트나 워드프로세스 파일로 된 기존 로그의 명세가 있는 경우, 그것을 가져오기 위한 스크립트를 작성.
- 기존 로그도 새로운 로그 표준으로 변환될 경우, 유지 보수성이 좋아지고 프레임웍이 제공하는 다양한 툴을 활용할 수 있을 것이다.
